<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Portal Shaders Dos Portales # Para esta etapa se propuso implementar correctamente 2 portales junto con su visualización y teletrasportación del personaje acorde a la posición y ángulo de entrada.
Se ubicó tanto el personaje como los dos portales en un espacio más controlado en donde se implementan las colisiones con paredes y algunos objetos como punto de referencia para el jugador.
Los shaders en esta ocasión funcionan correctamente para la visualización de la habitación y proyecciones planeadas."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content><meta property="og:description" content="Portal Shaders Dos Portales # Para esta etapa se propuso implementar correctamente 2 portales junto con su visualización y teletrasportación del personaje acorde a la posición y ángulo de entrada.
Se ubicó tanto el personaje como los dos portales en un espacio más controlado en donde se implementan las colisiones con paredes y algunos objetos como punto de referencia para el jugador.
Los shaders en esta ocasión funcionan correctamente para la visualización de la habitación y proyecciones planeadas."><meta property="og:type" content="article"><meta property="og:url" content="https://jussilvaca.github.io/docs/talleres/shadersExercises/portalShaders/"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2022-12-04T03:32:48-05:00"><title>Portal Shaders | Talleres Compuvisual</title><link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png type=image/x-icon><link rel=stylesheet href=/book.min.ab46de3e725a6415339a37bba23a0067534a37289b063c9f8d011515a63097a8.css integrity="sha256-q0bePnJaZBUzmje7ojoAZ1NKNyibBjyfjQEVFaYwl6g=" crossorigin=anonymous><script defer src=/flexsearch.min.js></script>
<script defer src=/en.search.min.3171e6efc6465a93203cedea49a2a3905e80310d72a454dbb1c1ab0473d5d7a3.js integrity="sha256-MXHm78ZGWpMgPO3qSaKjkF6AMQ1ypFTbscGrBHPV16M=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>Talleres Compuvisual</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li class=book-section-flat><span>Talleres</span><ul><li><a href=/docs/talleres/ilusiones/>Ilusiones</a></li><li><a href=/docs/talleres/portal/>Portal</a></li><li><input type=checkbox id=section-20254d110ff8452ca0de0eeedce0e13b class=toggle checked>
<label for=section-20254d110ff8452ca0de0eeedce0e13b class="flex justify-between"><a href=/docs/talleres/shadersExercises/>Shaders Exercises</a></label><ul><li><a href=/docs/talleres/shadersExercises/blendModes/>Blend Modes</a></li><li><a href=/docs/talleres/shadersExercises/nonEuclidean/>Non Euclidean</a></li><li><a href=/docs/talleres/shadersExercises/portalShaders/ class=active>Portal Shaders</a></li><li><a href=/docs/talleres/shadersExercises/spatialCoherence/>Spatial Coherence</a></li><li><a href=/docs/talleres/shadersExercises/texturing/>Texturing</a></li></ul></li></ul></li></ul><ul><li><a href=/posts/>Blog</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Portal Shaders</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><ul><li><a href=#portal-shaders-dos-portales>Portal Shaders Dos Portales</a></li><li><a href=#portal-shaders-con-múltiples-reflejos>Portal Shaders Con Múltiples reflejos</a></li></ul></li></ul></nav></aside></header><article class=markdown><h2 id=portal-shaders-dos-portales>Portal Shaders Dos Portales
<a class=anchor href=#portal-shaders-dos-portales>#</a></h2><p>Para esta etapa se propuso implementar correctamente 2 portales junto con su visualización y teletrasportación del personaje acorde a la posición y ángulo de entrada.</p><p>Se ubicó tanto el personaje como los dos portales en un espacio más controlado en donde se implementan las colisiones con paredes y algunos objetos como punto de referencia para el jugador.</p><p>Los shaders en esta ocasión funcionan correctamente para la visualización de la habitación y proyecciones planeadas.</p><p>Para esta etapa del proyecto restan hacer dos correcciones importantes:</br>1) Corregir la cantidad de teletrasportaciones (entradas al portal).</br>2) Que en el portal se visualice a su vez el otro portal y sus reflejos (Como cuando se enfrenta un espejo frente a otro).</p><details><summary>portalShaderV2.js</summary><div class=markdown-inner><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>press</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;  <span style=color:#75715e>// variable get info funcions
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>changeCam</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#75715e>//variable that indicate the position of the camera
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>angle</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#75715e>// angle of rotation of some objects
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>kemonaSilver</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>player1</span>, <span style=color:#a6e22e>playerOnPortal1</span>, <span style=color:#a6e22e>playerOnPortal2</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>fbo1</span>, <span style=color:#a6e22e>fbo1TextPort1</span>, <span style=color:#a6e22e>fbo1TextPort2</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>portalShader</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>portal1Onfbo1</span>, <span style=color:#a6e22e>portal2Onfbo1</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// obj models
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>fox</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>cat1</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>cat2</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>// texture of models
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>fox_tex</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>cat1_tex</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>cat2_tex</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>set1</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>set2</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>starCheck1</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>starCheck2</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>restart</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>teleportedFbo1</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>, <span style=color:#a6e22e>teleportedFbo2</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>cam1</span>, <span style=color:#a6e22e>cam2</span>, <span style=color:#a6e22e>cam3</span>, <span style=color:#a6e22e>cam4</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>cam3Pos</span>, <span style=color:#a6e22e>cam4Pos</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>onCam1</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>, <span style=color:#a6e22e>onCam2</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>dummy</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>preload</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>kemonaSilver</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>loadImage</span>(<span style=color:#e6db74>&#39;/assets/image/KemonaPlushSilver.jpg&#39;</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fox_tex</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>loadImage</span>(<span style=color:#e6db74>&#39;/assets/models/fox.png&#39;</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fox</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>loadModel</span>(<span style=color:#e6db74>&#39;/assets/models/fox.obj&#39;</span>, <span style=color:#66d9ef>true</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>cat1_tex</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>loadImage</span>(<span style=color:#e6db74>&#39;/assets/models/cat_plush_01.png&#39;</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>cat1</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>loadModel</span>(<span style=color:#e6db74>&#39;/assets/models/catPlush.obj&#39;</span>, <span style=color:#66d9ef>true</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>cat2_tex</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>loadImage</span>(<span style=color:#e6db74>&#39;/assets/models/cat_plush_02.png&#39;</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>cat2</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>loadModel</span>(<span style=color:#e6db74>&#39;/assets/models/catPlush.obj&#39;</span>, <span style=color:#66d9ef>true</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>portalShader</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>readShader</span>(<span style=color:#e6db74>&#39;/assets/shader/portal.frag&#39;</span>, { <span style=color:#a6e22e>varyings</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>NONE</span> });
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>setup</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>createCanvas</span>(<span style=color:#ae81ff>900</span>, <span style=color:#ae81ff>900</span>, <span style=color:#a6e22e>WEBGL</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>dummy</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createGraphics</span>(<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#a6e22e>WEBGL</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo1</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createGraphics</span>(<span style=color:#ae81ff>900</span>, <span style=color:#ae81ff>900</span>, <span style=color:#a6e22e>WEBGL</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo2</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createGraphics</span>(<span style=color:#ae81ff>900</span>, <span style=color:#ae81ff>900</span>, <span style=color:#a6e22e>WEBGL</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo1TextPort1</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createGraphics</span>(<span style=color:#ae81ff>900</span>, <span style=color:#ae81ff>900</span>, <span style=color:#a6e22e>WEBGL</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo1TextPort2</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createGraphics</span>(<span style=color:#ae81ff>900</span>, <span style=color:#ae81ff>900</span>, <span style=color:#a6e22e>WEBGL</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>player1</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Player</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>100</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>playerOnPortal1</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Player</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>playerOnPortal2</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Player</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>portal1Onfbo1</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Portal</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>437</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>portal2Onfbo1</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Portal</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>437</span>, <span style=color:#a6e22e>PI</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>portal2Onfbo1</span>.<span style=color:#a6e22e>link</span>(<span style=color:#a6e22e>portal1Onfbo1</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>cam1</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>fbo1</span>.<span style=color:#a6e22e>createCamera</span>(); <span style=color:#75715e>// firts person camera
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>cam2</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Dw</span>.<span style=color:#a6e22e>EasyCam</span>(<span style=color:#a6e22e>fbo1</span>.<span style=color:#a6e22e>_renderer</span>, {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>distance</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>848.5208406737183</span>, <span style=color:#75715e>// scalar (optional)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>center</span><span style=color:#f92672>:</span> [<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>],         <span style=color:#75715e>// vector (optional)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>rotation</span><span style=color:#f92672>:</span> [<span style=color:#ae81ff>0.9686568165691878</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>0.24785495689905887</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>0.014390494259618537</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>0.008050200592452867</span>],  <span style=color:#75715e>// quaternion (optional)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    });
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>cam2</span>.<span style=color:#a6e22e>attachMouseListeners</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_renderer</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>state2</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>cam2</span>.<span style=color:#a6e22e>getState</span>();
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>cam2</span>.<span style=color:#a6e22e>state_reset</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>state2</span>;   <span style=color:#75715e>// state to use on reset (double-click/tap)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>cam2</span>.<span style=color:#a6e22e>setViewport</span>([<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>900</span>, <span style=color:#ae81ff>900</span>]);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>cam3</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>fbo1TextPort1</span>.<span style=color:#a6e22e>createCamera</span>(); <span style=color:#75715e>// camera on portal 1
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>cam4</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>fbo1TextPort2</span>.<span style=color:#a6e22e>createCamera</span>(); <span style=color:#75715e>// camera on portal 2
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>draw</span>() {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 1. compute current main canvas camera params
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>position</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>fbo1</span>.<span style=color:#a6e22e>treeLocation</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>center</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Vector</span>.<span style=color:#a6e22e>add</span>(<span style=color:#a6e22e>position</span>, <span style=color:#a6e22e>fbo1</span>.<span style=color:#a6e22e>treeDisplacement</span>());
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>up</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>fbo1</span>.<span style=color:#a6e22e>treeDisplacement</span>(<span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>j</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo1TextPort1</span>.<span style=color:#a6e22e>camera</span>(<span style=color:#a6e22e>position</span>.<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>position</span>.<span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>position</span>.<span style=color:#a6e22e>z</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>center</span>.<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>center</span>.<span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>center</span>.<span style=color:#a6e22e>z</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>up</span>.<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>up</span>.<span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>up</span>.<span style=color:#a6e22e>z</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>position1</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>fbo1</span>.<span style=color:#a6e22e>treeLocation</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>center1</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Vector</span>.<span style=color:#a6e22e>add</span>(<span style=color:#a6e22e>position1</span>, <span style=color:#a6e22e>fbo1</span>.<span style=color:#a6e22e>treeDisplacement</span>());
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>up1</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>fbo1</span>.<span style=color:#a6e22e>treeDisplacement</span>(<span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>j</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo1TextPort2</span>.<span style=color:#a6e22e>camera</span>(<span style=color:#a6e22e>position1</span>.<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>position1</span>.<span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>position1</span>.<span style=color:#a6e22e>z</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>center1</span>.<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>center1</span>.<span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>center1</span>.<span style=color:#a6e22e>z</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>up1</span>.<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>up1</span>.<span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>up1</span>.<span style=color:#a6e22e>z</span>);
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 2. set scenes
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>scene</span>(<span style=color:#a6e22e>fbo1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>scene</span>(<span style=color:#a6e22e>fbo1TextPort1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>scene</span>(<span style=color:#a6e22e>fbo1TextPort2</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>teleportedFbo1</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>!</span><span style=color:#a6e22e>teleportedFbo2</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>player1</span>.<span style=color:#a6e22e>movement</span>();
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>player1</span>.<span style=color:#a6e22e>render</span>(<span style=color:#a6e22e>fbo1</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>restart</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>        <span style=color:#75715e>// if (abs(player1.playerPos.z) &lt; (abs(portal1Onfbo1.portalPos.z) - 40)) {
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>//     starCheck1 = 1;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>// }
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// if (abs(player1.playerPos.z) &lt; (abs(portal2Onfbo1.portalPos.z) - 40)) {
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>//     starCheck2 = 1;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>// }
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// if (starCheck1) {
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>//     teleportedFbo1 = portal1Onfbo1.check(player1)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>// }
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// if (starCheck2) {
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>//     teleportedFbo2 = portal2Onfbo1.check(player1)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>//     console.log(&#34;SSSSSSSSSS&#34;);
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>// }
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>teleportedFbo1</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>teleportedFbo2</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>player1</span>.<span style=color:#a6e22e>movement</span>();
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>player1</span>.<span style=color:#a6e22e>render</span>(<span style=color:#a6e22e>fbo1</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>restart</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>        <span style=color:#75715e>// console.log(&#34;KLAJSHKJALHDAD&#34;);
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// if (abs(player1.playerPos.z) &lt; (abs(portal1Onfbo1.portalPos.z) - 40)) {
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>//     starCheck1 = 1;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>// }
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// if (abs(player1.playerPos.z) &lt; (abs(portal2Onfbo1.portalPos.z) - 40)) {
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>//     starCheck2 = 1;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>// }
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// // if (starCheck1) {
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>// //     teleportedFbo1 = portal1Onfbo1.check(player1)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>// // }
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// // if (starCheck2) {
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>// //     teleportedFbo2 = portal2Onfbo1.check(player1)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>// // }
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>restart</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>set1</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>set2</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>starCheck1</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>starCheck2</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>teleportedFbo1</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>teleportedFbo2</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>restart</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> ((<span style=color:#f92672>!</span><span style=color:#a6e22e>teleportedFbo1</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>!</span><span style=color:#a6e22e>teleportedFbo2</span>)) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>player1</span>.<span style=color:#a6e22e>movement</span>();
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>player1</span>.<span style=color:#a6e22e>render</span>(<span style=color:#a6e22e>fbo1</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>abs</span>(<span style=color:#a6e22e>player1</span>.<span style=color:#a6e22e>playerPos</span>.<span style=color:#a6e22e>z</span>) <span style=color:#f92672>&lt;</span> (<span style=color:#a6e22e>abs</span>(<span style=color:#a6e22e>portal1Onfbo1</span>.<span style=color:#a6e22e>portalPos</span>.<span style=color:#a6e22e>z</span>) <span style=color:#f92672>-</span> <span style=color:#ae81ff>40</span>)) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>starCheck1</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>abs</span>(<span style=color:#a6e22e>player1</span>.<span style=color:#a6e22e>playerPos</span>.<span style=color:#a6e22e>z</span>) <span style=color:#f92672>&lt;</span> (<span style=color:#a6e22e>abs</span>(<span style=color:#a6e22e>portal2Onfbo1</span>.<span style=color:#a6e22e>portalPos</span>.<span style=color:#a6e22e>z</span>) <span style=color:#f92672>-</span> <span style=color:#ae81ff>40</span>)) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>starCheck2</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>starCheck1</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>teleportedFbo1</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>portal1Onfbo1</span>.<span style=color:#a6e22e>check</span>(<span style=color:#a6e22e>player1</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>starCheck2</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>teleportedFbo2</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>portal2Onfbo1</span>.<span style=color:#a6e22e>check</span>(<span style=color:#a6e22e>player1</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>teleportedFbo1</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>set1</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;teleportedFbo1&#34;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>teleportedFbo2</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>set2</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;teleportedFbo2&#34;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>set1</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>player1</span>.<span style=color:#a6e22e>pos</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>portal2Onfbo1</span>.<span style=color:#a6e22e>portalPos</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>set1</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>set2</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>player1</span>.<span style=color:#a6e22e>pos</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>portal1Onfbo1</span>.<span style=color:#a6e22e>portalPos</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>set2</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>player1</span>.<span style=color:#a6e22e>playerPos</span> <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>playerOnPortal1</span>.<span style=color:#a6e22e>pos</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>player1</span>.<span style=color:#a6e22e>pos</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>playerOnPortal1</span>.<span style=color:#a6e22e>a</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>player1</span>.<span style=color:#a6e22e>a</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>playerOnPortal1</span>.<span style=color:#a6e22e>render</span>(<span style=color:#a6e22e>fbo1TextPort1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>playerOnPortal2</span>.<span style=color:#a6e22e>pos</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>player1</span>.<span style=color:#a6e22e>pos</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>playerOnPortal2</span>.<span style=color:#a6e22e>a</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>player1</span>.<span style=color:#a6e22e>a</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>playerOnPortal2</span>.<span style=color:#a6e22e>render</span>(<span style=color:#a6e22e>fbo1TextPort2</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>angle</span> <span style=color:#f92672>+=</span> <span style=color:#ae81ff>0.007</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>portal1Onfbo1</span>.<span style=color:#a6e22e>render</span>(<span style=color:#a6e22e>fbo1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>fbo1TextPort1</span>, <span style=color:#a6e22e>portalShader</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>portal2Onfbo1</span>.<span style=color:#a6e22e>render</span>(<span style=color:#a6e22e>fbo1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#a6e22e>fbo1TextPort2</span>, <span style=color:#a6e22e>portalShader</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>camCoor</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>camFovCoordinates</span>(<span style=color:#f92672>-</span><span style=color:#ae81ff>900</span>, <span style=color:#a6e22e>player1</span>.<span style=color:#a6e22e>pos</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>player1</span>.<span style=color:#a6e22e>a</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>60</span>, <span style=color:#ae81ff>40</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>cam1</span>.<span style=color:#a6e22e>camera</span>(<span style=color:#a6e22e>camCoor</span>.<span style=color:#a6e22e>xp</span>, <span style=color:#a6e22e>camCoor</span>.<span style=color:#a6e22e>yp</span>, <span style=color:#a6e22e>camCoor</span>.<span style=color:#a6e22e>zp</span>, <span style=color:#a6e22e>camCoor</span>.<span style=color:#a6e22e>xc</span>, <span style=color:#a6e22e>camCoor</span>.<span style=color:#a6e22e>yc</span>, <span style=color:#a6e22e>camCoor</span>.<span style=color:#a6e22e>zc</span>, <span style=color:#a6e22e>camCoor</span>.<span style=color:#a6e22e>xn</span>, <span style=color:#a6e22e>camCoor</span>.<span style=color:#a6e22e>yn</span>, <span style=color:#a6e22e>camCoor</span>.<span style=color:#a6e22e>zn</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>changeCam</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>onCam1</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>cam2</span>.<span style=color:#a6e22e>setCanvas</span>(<span style=color:#a6e22e>dummy</span>.<span style=color:#a6e22e>_renderer</span>);
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fbo1</span>.<span style=color:#a6e22e>setCamera</span>(<span style=color:#a6e22e>cam1</span>)
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>onCam1</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>onCam2</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>onCam2</span>) {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>fbo1</span>.<span style=color:#a6e22e>reset</span>();
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>cam2</span>.<span style=color:#a6e22e>setCanvas</span>(<span style=color:#a6e22e>fbo1</span>.<span style=color:#a6e22e>_renderer</span>);
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>onCam1</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>onCam2</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>changeCam</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>press</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>({ <span style=color:#a6e22e>x</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>player1</span>.<span style=color:#a6e22e>pos</span>.<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>player1</span>.<span style=color:#a6e22e>pos</span>.<span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>z</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>player1</span>.<span style=color:#a6e22e>pos</span>.<span style=color:#a6e22e>z</span> });
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>({ <span style=color:#a6e22e>angle</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>player1</span>.<span style=color:#a6e22e>a</span> });
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>v</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Vector</span>.<span style=color:#a6e22e>fromAngle</span>(<span style=color:#a6e22e>player1</span>.<span style=color:#a6e22e>a</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>({ <span style=color:#a6e22e>x</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>v</span>.<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>v</span>.<span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>z</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>v</span>.<span style=color:#a6e22e>z</span> });
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>press</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>beginHUD</span>();
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>image</span>(<span style=color:#a6e22e>fbo1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>endHUD</span>();
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Player</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>constructor</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>z</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pos</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createVector</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>z</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>prevPos</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pos</span>.<span style=color:#a6e22e>copy</span>();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>a</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>speed</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>aspeed</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>PI</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>90</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>playerPos</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pos</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>playerDis</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>move</span>(<span style=color:#a6e22e>fw</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>prevPos</span>.<span style=color:#a6e22e>set</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pos</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>vel</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Vector</span>.<span style=color:#a6e22e>fromAngle</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>a</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>fw</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>vel</span>.<span style=color:#a6e22e>mult</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>speed</span>);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pos</span>.<span style=color:#a6e22e>add</span>(<span style=color:#f92672>-</span><span style=color:#a6e22e>vel</span>.<span style=color:#a6e22e>x</span>, <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>vel</span>.<span style=color:#a6e22e>y</span>);
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>vel</span>.<span style=color:#a6e22e>mult</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>speed</span>);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pos</span>.<span style=color:#a6e22e>add</span>(<span style=color:#a6e22e>vel</span>.<span style=color:#a6e22e>x</span>, <span style=color:#ae81ff>0</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>vel</span>.<span style=color:#a6e22e>y</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pos</span>.<span style=color:#a6e22e>x</span> <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>400</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pos</span>.<span style=color:#a6e22e>x</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>400</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pos</span>.<span style=color:#a6e22e>z</span> <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>400</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pos</span>.<span style=color:#a6e22e>z</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>400</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pos</span>.<span style=color:#a6e22e>x</span> <span style=color:#f92672>&lt;</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>400</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pos</span>.<span style=color:#a6e22e>x</span> <span style=color:#f92672>=</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>400</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pos</span>.<span style=color:#a6e22e>z</span> <span style=color:#f92672>&lt;</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>410</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pos</span>.<span style=color:#a6e22e>z</span> <span style=color:#f92672>=</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>410</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>movement</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>keyIsDown</span>(<span style=color:#ae81ff>65</span>))
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>turn</span>(<span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>keyIsDown</span>(<span style=color:#ae81ff>68</span>))
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>turn</span>(<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>keyIsDown</span>(<span style=color:#ae81ff>87</span>))
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>move</span>(<span style=color:#66d9ef>true</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>keyIsDown</span>(<span style=color:#ae81ff>83</span>))
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>move</span>(<span style=color:#66d9ef>false</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>turn</span>(<span style=color:#a6e22e>dir</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>a</span> <span style=color:#f92672>+=</span> <span style=color:#a6e22e>dir</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>aspeed</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>render</span>(<span style=color:#a6e22e>fbo</span>, <span style=color:#a6e22e>fboOff1</span>, <span style=color:#a6e22e>fboOff2</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>push</span>();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>fboOff1</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>translate</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>870</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>fboOff2</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>translate</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>870</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>translate</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pos</span>.<span style=color:#a6e22e>x</span>, <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pos</span>.<span style=color:#a6e22e>y</span>, <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pos</span>.<span style=color:#a6e22e>z</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>rotateY</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>a</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>noStroke</span>();
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>push</span>();
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>rotateZ</span>(<span style=color:#a6e22e>PI</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>rotateY</span>(<span style=color:#a6e22e>HALF_PI</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>texture</span>(<span style=color:#a6e22e>fox_tex</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>model</span>(<span style=color:#a6e22e>fox</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>pop</span>();
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>pop</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Portal</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>constructor</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>z</span>, <span style=color:#a6e22e>a</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pos</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createVector</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>z</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>len</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>220</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>a</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>a</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>portalPos</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>linkedPortal</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>link</span>(<span style=color:#a6e22e>other</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>linkedPortal</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>other</span>;
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>other</span>.<span style=color:#a6e22e>linkedPortal</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>check_</span>(<span style=color:#a6e22e>player</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>relativePos</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>player</span>.<span style=color:#a6e22e>playerPos</span>.<span style=color:#a6e22e>copy</span>();
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>relativePos</span>.<span style=color:#a6e22e>sub</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>portalPos</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>relativePos</span>.<span style=color:#a6e22e>rotate</span>(<span style=color:#f92672>-</span><span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>a</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>relativePrevPos</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>player</span>.<span style=color:#a6e22e>prevPos</span>.<span style=color:#a6e22e>copy</span>();
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>relativePrevPos</span>.<span style=color:#a6e22e>sub</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>portalPos</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>relativePrevPos</span>.<span style=color:#a6e22e>rotate</span>(<span style=color:#f92672>-</span><span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>a</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> ((<span style=color:#a6e22e>abs</span>(<span style=color:#a6e22e>relativePos</span>.<span style=color:#a6e22e>z</span>) <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>38</span>) <span style=color:#f92672>!==</span> (<span style=color:#a6e22e>abs</span>(<span style=color:#a6e22e>relativePrevPos</span>.<span style=color:#a6e22e>z</span>) <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>38</span>) <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>abs</span>(<span style=color:#a6e22e>relativePos</span>.<span style=color:#a6e22e>x</span>) <span style=color:#f92672>&lt;</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>len</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;Teletransportado&#34;</span>);
</span></span><span style=display:flex><span>            <span style=color:#75715e>// player.a += this.linkedPortal.a - this.a;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>check</span>(<span style=color:#a6e22e>player</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>check_</span>(<span style=color:#a6e22e>player</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>render</span>(<span style=color:#a6e22e>fbo</span>, <span style=color:#a6e22e>numberPortal</span>, <span style=color:#a6e22e>texElement</span>, <span style=color:#a6e22e>portalShader</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>push</span>()
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>translate</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pos</span>.<span style=color:#a6e22e>x</span>, <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pos</span>.<span style=color:#a6e22e>y</span>, <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pos</span>.<span style=color:#a6e22e>z</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>rotateY</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>a</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>push</span>()
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>translate</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>numberPortal</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>fill</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>255</span>)
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>fill</span>(<span style=color:#ae81ff>255</span>, <span style=color:#ae81ff>158</span>, <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>circle</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>260</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>pop</span>()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>portalShader</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>shader</span>(<span style=color:#a6e22e>portalShader</span>);
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>emitResolution</span>(<span style=color:#a6e22e>portalShader</span>);
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>portalShader</span>.<span style=color:#a6e22e>setUniform</span>(<span style=color:#e6db74>&#39;texture&#39;</span>, <span style=color:#a6e22e>texElement</span>);
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>texElement</span>) {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>texture</span>(<span style=color:#a6e22e>texElement</span>);
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>circle</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>250</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>portalPos</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>treeLocation</span>(<span style=color:#75715e>/*[0, 0, 0],*/</span> { <span style=color:#a6e22e>from</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>MODEL</span>, <span style=color:#a6e22e>to</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>WORLD</span> });
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>pop</span>()
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>scene</span>(<span style=color:#a6e22e>fbo</span>, <span style=color:#a6e22e>fboOff1</span>, <span style=color:#a6e22e>fboOff2</span>, <span style=color:#a6e22e>frontWall</span>, <span style=color:#a6e22e>backWall</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>background</span>(<span style=color:#ae81ff>120</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>reset</span>();
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>rectMode</span>(<span style=color:#a6e22e>CENTER</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>noStroke</span>();
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>push</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>fboOff1</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>translate</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>870</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>fboOff2</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>translate</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>870</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>ambientLight</span>(<span style=color:#ae81ff>255</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>push</span>();
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>rotateZ</span>(<span style=color:#a6e22e>angle</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>rotateX</span>(<span style=color:#a6e22e>angle</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>rotateY</span>(<span style=color:#a6e22e>angle</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>texture</span>(<span style=color:#a6e22e>kemonaSilver</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>box</span>(<span style=color:#ae81ff>100</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>pop</span>();
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>push</span>();
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>translate</span>(<span style=color:#f92672>-</span><span style=color:#ae81ff>350</span>, <span style=color:#ae81ff>0</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>350</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>rotateZ</span>(<span style=color:#a6e22e>angle</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>rotateX</span>(<span style=color:#a6e22e>angle</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>rotateY</span>(<span style=color:#a6e22e>angle</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>texture</span>(<span style=color:#a6e22e>cat1_tex</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>model</span>(<span style=color:#a6e22e>cat1</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>pop</span>();
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>push</span>();
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>translate</span>(<span style=color:#ae81ff>350</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>350</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>rotateZ</span>(<span style=color:#a6e22e>angle</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>rotateX</span>(<span style=color:#a6e22e>angle</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>rotateY</span>(<span style=color:#a6e22e>angle</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>texture</span>(<span style=color:#a6e22e>cat2_tex</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>model</span>(<span style=color:#a6e22e>cat2</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>pop</span>();
</span></span><span style=display:flex><span>    <span style=color:#75715e>// PISO
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>push</span>();
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>stroke</span>(<span style=color:#ae81ff>2</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>ambientLight</span>(<span style=color:#ae81ff>255</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>ambientMaterial</span>(<span style=color:#ae81ff>100</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>translate</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>110</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>rotateX</span>(<span style=color:#a6e22e>HALF_PI</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>box</span>(<span style=color:#ae81ff>900</span>, <span style=color:#ae81ff>900</span>, <span style=color:#ae81ff>20</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>pop</span>();
</span></span><span style=display:flex><span>    <span style=color:#75715e>// PAREDES
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>frontWall</span>) {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Frontal Z+
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>push</span>();
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>stroke</span>(<span style=color:#ae81ff>2</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>ambientLight</span>(<span style=color:#ae81ff>255</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>ambientMaterial</span>(<span style=color:#ae81ff>100</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>translate</span>(<span style=color:#ae81ff>0</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>25</span>, <span style=color:#ae81ff>450</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>box</span>(<span style=color:#ae81ff>900</span>, <span style=color:#ae81ff>250</span>, <span style=color:#ae81ff>20</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>pop</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>backWall</span>) {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Trasera Z-
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>push</span>();
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>stroke</span>(<span style=color:#ae81ff>2</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>ambientLight</span>(<span style=color:#ae81ff>255</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>ambientMaterial</span>(<span style=color:#ae81ff>100</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>translate</span>(<span style=color:#ae81ff>0</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>25</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>450</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>box</span>(<span style=color:#ae81ff>900</span>, <span style=color:#ae81ff>250</span>, <span style=color:#ae81ff>20</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>pop</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Lateral Derecha X+
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>push</span>();
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>stroke</span>(<span style=color:#ae81ff>2</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>ambientLight</span>(<span style=color:#ae81ff>255</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>ambientMaterial</span>(<span style=color:#ae81ff>100</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>translate</span>(<span style=color:#ae81ff>450</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>25</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>rotateY</span>(<span style=color:#a6e22e>HALF_PI</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>box</span>(<span style=color:#ae81ff>900</span>, <span style=color:#ae81ff>250</span>, <span style=color:#ae81ff>20</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>pop</span>();
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Trasera Izquierda X-
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>push</span>();
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>stroke</span>(<span style=color:#ae81ff>2</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>ambientLight</span>(<span style=color:#ae81ff>255</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>ambientMaterial</span>(<span style=color:#ae81ff>100</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>translate</span>(<span style=color:#f92672>-</span><span style=color:#ae81ff>450</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>25</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>rotateY</span>(<span style=color:#a6e22e>HALF_PI</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>box</span>(<span style=color:#ae81ff>900</span>, <span style=color:#ae81ff>250</span>, <span style=color:#ae81ff>20</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>pop</span>();
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>pop</span>();
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>keyPressed</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>keyCode</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>67</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>changeCam</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>changeCam</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>keyCode</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>73</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>press</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>press</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>camFovCoordinates</span>(<span style=color:#a6e22e>radio</span>, <span style=color:#a6e22e>posVec</span>, <span style=color:#a6e22e>angle</span>, <span style=color:#a6e22e>hy</span>, <span style=color:#a6e22e>chy</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>vecAngle</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Vector</span>.<span style=color:#a6e22e>fromAngle</span>(<span style=color:#a6e22e>angle</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>radioCam</span> <span style=color:#f92672>=</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>10</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> { <span style=color:#a6e22e>xp</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>posVec</span>.<span style=color:#a6e22e>x</span> <span style=color:#f92672>+</span> (<span style=color:#a6e22e>radioCam</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>vecAngle</span>.<span style=color:#a6e22e>x</span>)), <span style=color:#a6e22e>yp</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>posVec</span>.<span style=color:#a6e22e>y</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>hy</span>, <span style=color:#a6e22e>zp</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>posVec</span>.<span style=color:#a6e22e>z</span> <span style=color:#f92672>+</span> (<span style=color:#a6e22e>radioCam</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>vecAngle</span>.<span style=color:#a6e22e>y</span>)), <span style=color:#a6e22e>xc</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>posVec</span>.<span style=color:#a6e22e>x</span> <span style=color:#f92672>+</span> (<span style=color:#a6e22e>radio</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>vecAngle</span>.<span style=color:#a6e22e>x</span>)), <span style=color:#a6e22e>yc</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>posVec</span>.<span style=color:#a6e22e>y</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>chy</span>, <span style=color:#a6e22e>zc</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>posVec</span>.<span style=color:#a6e22e>z</span> <span style=color:#f92672>+</span> (<span style=color:#a6e22e>radio</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>vecAngle</span>.<span style=color:#a6e22e>y</span>)), <span style=color:#a6e22e>xn</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>yn</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>1</span>, <span style=color:#a6e22e>zn</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span> };
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></div></details><details><summary>Comandos</summary><div class=markdown-inner><table><thead><tr><th>Tecla</th><th>Descripción</th></tr></thead><tbody><tr><td>W</td><td>Mover hacia adelante</td></tr><tr><td>A</td><td>Girar hacia la izquierda</td></tr><tr><td>D</td><td>Girar hacia la derecha</td></tr><tr><td>S</td><td>Mover hacia atrás</td></tr><tr><td>C</td><td>Cambiar vista primera/tercera persona</td></tr></tbody></table></div></details><iframe id=portalShaderV2 style=width:925px;height:925px srcdoc="
        <!DOCTYPE html>
        <html>
          <head>
            <script src=https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/p5.min.js></script>
            <script src=https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/addons/p5.sound.min.js></script>
             <script src=https://cdn.jsdelivr.net/gh/VisualComputing/p5.treegl/p5.treegl.js></script> 
             <script src=https://cdn.jsdelivr.net/gh/freshfork/p5.EasyCam@1.2.1/p5.easycam.js></script> 
            
            
            
            <script src=/sketches/portalShaderV2.js></script>
          </head>
          <body>
          </body>
        </html>
      "></iframe><h2 id=portal-shaders-con-múltiples-reflejos>Portal Shaders Con Múltiples reflejos
<a class=anchor href=#portal-shaders-con-m%c3%baltiples-reflejos>#</a></h2><p>En esta última etapa se incorporan los dos objetivos faltantes en la etapa anterior.</p><p>Primero, se corrigen las colisiones y la cantidad de veces que puede entrar el personaje al portal.</p><p>Y por último, se adiciona dentro del portal los reflejos creados en el portal opuesto, de modo que dentro del portal se visualizan hasta 5 proyecciones de sí mismo para dar un efecto más realista y que acate los conceptos postulados por el juego original.</p><details><summary>portalShaderV3.js</summary><div class=markdown-inner><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>press</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;  <span style=color:#75715e>// variable get info funcions
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>changeCam</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#75715e>//variable that indicate the position of the camera
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>angle</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#75715e>// angle of rotation of some objects
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>kemonaSilver</span>; <span style=color:#75715e>// Textura del cubo central
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>player1</span>, <span style=color:#a6e22e>playerOnPortal1</span>, <span style=color:#a6e22e>playerOnPortal2</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>fbo1</span>, <span style=color:#a6e22e>fbo1TextPort1</span>, <span style=color:#a6e22e>fbo1TextPort2</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>fbo1Off1</span>, <span style=color:#a6e22e>fbo1Off2</span>, <span style=color:#a6e22e>fbo1Off3</span>, <span style=color:#a6e22e>fbo1Off4</span>, <span style=color:#a6e22e>fbo2Off1</span>, <span style=color:#a6e22e>fbo2Off2</span>, <span style=color:#a6e22e>fbo2Off3</span>, <span style=color:#a6e22e>fbo2Off4</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>portalShader</span>, <span style=color:#a6e22e>shader1Aux1</span>, <span style=color:#a6e22e>shader1Aux2</span>, <span style=color:#a6e22e>shader1Aux3</span>, <span style=color:#a6e22e>shader1Aux4</span>, <span style=color:#a6e22e>shader2Aux1</span>, <span style=color:#a6e22e>shader2Aux2</span>, <span style=color:#a6e22e>shader2Aux3</span>, <span style=color:#a6e22e>shader2Aux4</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>portal1Onfbo1</span>, <span style=color:#a6e22e>portal2Onfbo1</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>portal1Onfbo1Off</span>, <span style=color:#a6e22e>portal2Onfbo1Off</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>portal1Off1</span>, <span style=color:#a6e22e>portal1Off2</span>, <span style=color:#a6e22e>portal1Off3</span>, <span style=color:#a6e22e>portal2Off1</span>, <span style=color:#a6e22e>portal2Off2</span>, <span style=color:#a6e22e>portal2Off3</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// obj models
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>fox</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>cat1</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>cat2</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>// texture of models
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>fox_tex</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>cat1_tex</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>cat2_tex</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>set1</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>set2</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>starCheck1</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>starCheck2</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>restart</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>teleportedFbo1</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>, <span style=color:#a6e22e>teleportedFbo2</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>cam1</span>, <span style=color:#a6e22e>cam2</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>onCam1</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>, <span style=color:#a6e22e>onCam2</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>dummy</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>preload</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>kemonaSilver</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>loadImage</span>(<span style=color:#e6db74>&#39;/assets/image/KemonaPlushSilver.jpg&#39;</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fox_tex</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>loadImage</span>(<span style=color:#e6db74>&#39;/assets/models/fox.png&#39;</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fox</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>loadModel</span>(<span style=color:#e6db74>&#39;/assets/models/fox.obj&#39;</span>, <span style=color:#66d9ef>true</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>cat1_tex</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>loadImage</span>(<span style=color:#e6db74>&#39;/assets/models/cat_plush_01.png&#39;</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>cat1</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>loadModel</span>(<span style=color:#e6db74>&#39;/assets/models/catPlush.obj&#39;</span>, <span style=color:#66d9ef>true</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>cat2_tex</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>loadImage</span>(<span style=color:#e6db74>&#39;/assets/models/cat_plush_02.png&#39;</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>cat2</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>loadModel</span>(<span style=color:#e6db74>&#39;/assets/models/catPlush.obj&#39;</span>, <span style=color:#66d9ef>true</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>portalShader</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>readShader</span>(<span style=color:#e6db74>&#39;/assets/shader/portal2.frag&#39;</span>, { <span style=color:#a6e22e>varyings</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>NONE</span> });
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>shader1Aux1</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>readShader</span>(<span style=color:#e6db74>&#39;/assets/shader/portal2.frag&#39;</span>, { <span style=color:#a6e22e>varyings</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>NONE</span> });
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>shader1Aux2</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>readShader</span>(<span style=color:#e6db74>&#39;/assets/shader/portal2.frag&#39;</span>, { <span style=color:#a6e22e>varyings</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>NONE</span> });
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>shader1Aux3</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>readShader</span>(<span style=color:#e6db74>&#39;/assets/shader/portal2.frag&#39;</span>, { <span style=color:#a6e22e>varyings</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>NONE</span> });
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>shader1Aux4</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>readShader</span>(<span style=color:#e6db74>&#39;/assets/shader/portal2.frag&#39;</span>, { <span style=color:#a6e22e>varyings</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>NONE</span> });
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>shader2Aux1</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>readShader</span>(<span style=color:#e6db74>&#39;/assets/shader/portal2.frag&#39;</span>, { <span style=color:#a6e22e>varyings</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>NONE</span> });
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>shader2Aux2</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>readShader</span>(<span style=color:#e6db74>&#39;/assets/shader/portal2.frag&#39;</span>, { <span style=color:#a6e22e>varyings</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>NONE</span> });
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>shader2Aux3</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>readShader</span>(<span style=color:#e6db74>&#39;/assets/shader/portal2.frag&#39;</span>, { <span style=color:#a6e22e>varyings</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>NONE</span> });
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>shader2Aux4</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>readShader</span>(<span style=color:#e6db74>&#39;/assets/shader/portal2.frag&#39;</span>, { <span style=color:#a6e22e>varyings</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>NONE</span> });
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>setup</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>createCanvas</span>(<span style=color:#ae81ff>900</span>, <span style=color:#ae81ff>900</span>, <span style=color:#a6e22e>WEBGL</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>dummy</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createGraphics</span>(<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#a6e22e>WEBGL</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo1</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createGraphics</span>(<span style=color:#ae81ff>900</span>, <span style=color:#ae81ff>900</span>, <span style=color:#a6e22e>WEBGL</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo1Off1</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createGraphics</span>(<span style=color:#ae81ff>900</span>, <span style=color:#ae81ff>900</span>, <span style=color:#a6e22e>WEBGL</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo1Off2</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createGraphics</span>(<span style=color:#ae81ff>900</span>, <span style=color:#ae81ff>900</span>, <span style=color:#a6e22e>WEBGL</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo1Off3</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createGraphics</span>(<span style=color:#ae81ff>900</span>, <span style=color:#ae81ff>900</span>, <span style=color:#a6e22e>WEBGL</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo1Off4</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createGraphics</span>(<span style=color:#ae81ff>900</span>, <span style=color:#ae81ff>900</span>, <span style=color:#a6e22e>WEBGL</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo2Off1</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createGraphics</span>(<span style=color:#ae81ff>900</span>, <span style=color:#ae81ff>900</span>, <span style=color:#a6e22e>WEBGL</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo2Off2</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createGraphics</span>(<span style=color:#ae81ff>900</span>, <span style=color:#ae81ff>900</span>, <span style=color:#a6e22e>WEBGL</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo2Off3</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createGraphics</span>(<span style=color:#ae81ff>900</span>, <span style=color:#ae81ff>900</span>, <span style=color:#a6e22e>WEBGL</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo2Off4</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createGraphics</span>(<span style=color:#ae81ff>900</span>, <span style=color:#ae81ff>900</span>, <span style=color:#a6e22e>WEBGL</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo1TextPort1</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createGraphics</span>(<span style=color:#ae81ff>900</span>, <span style=color:#ae81ff>900</span>, <span style=color:#a6e22e>WEBGL</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo1TextPort2</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createGraphics</span>(<span style=color:#ae81ff>900</span>, <span style=color:#ae81ff>900</span>, <span style=color:#a6e22e>WEBGL</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>player1</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Player</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>100</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>playerOnPortal1</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Player</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>playerOnPortal2</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Player</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>portal1Onfbo1</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Portal</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>437</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>portal2Onfbo1</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Portal</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>437</span>, <span style=color:#a6e22e>PI</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>portal2Onfbo1</span>.<span style=color:#a6e22e>link</span>(<span style=color:#a6e22e>portal1Onfbo1</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>portal1Onfbo1Off</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Portal</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#f92672>-</span>(<span style=color:#ae81ff>437</span> <span style=color:#f92672>+</span> (<span style=color:#ae81ff>1</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>880</span>)), <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>portal1Off1</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Portal</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#f92672>-</span>(<span style=color:#ae81ff>437</span> <span style=color:#f92672>+</span> (<span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>880</span>)), <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>portal1Off2</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Portal</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#f92672>-</span>(<span style=color:#ae81ff>437</span> <span style=color:#f92672>+</span> (<span style=color:#ae81ff>3</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>880</span>)), <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>portal1Off3</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Portal</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#f92672>-</span>(<span style=color:#ae81ff>437</span> <span style=color:#f92672>+</span> (<span style=color:#ae81ff>4</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>880</span>)), <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>portal2Onfbo1Off</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Portal</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, (<span style=color:#ae81ff>437</span> <span style=color:#f92672>+</span> (<span style=color:#ae81ff>1</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>880</span>)), <span style=color:#a6e22e>PI</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>portal2Off1</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Portal</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, (<span style=color:#ae81ff>437</span> <span style=color:#f92672>+</span> (<span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>880</span>)), <span style=color:#a6e22e>PI</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>portal2Off2</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Portal</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, (<span style=color:#ae81ff>437</span> <span style=color:#f92672>+</span> (<span style=color:#ae81ff>3</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>880</span>)), <span style=color:#a6e22e>PI</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>portal2Off3</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Portal</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, (<span style=color:#ae81ff>437</span> <span style=color:#f92672>+</span> (<span style=color:#ae81ff>4</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>880</span>)), <span style=color:#a6e22e>PI</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>cam1</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>fbo1</span>.<span style=color:#a6e22e>createCamera</span>(); <span style=color:#75715e>// firts person camera
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>cam2</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Dw</span>.<span style=color:#a6e22e>EasyCam</span>(<span style=color:#a6e22e>fbo1</span>.<span style=color:#a6e22e>_renderer</span>, {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>distance</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>848.5208406737183</span>, <span style=color:#75715e>// scalar (optional)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>center</span><span style=color:#f92672>:</span> [<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>],         <span style=color:#75715e>// vector (optional)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>rotation</span><span style=color:#f92672>:</span> [<span style=color:#ae81ff>0.9686568165691878</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>0.24785495689905887</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>0.014390494259618537</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>0.008050200592452867</span>],  <span style=color:#75715e>// quaternion (optional)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    });
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>cam2</span>.<span style=color:#a6e22e>attachMouseListeners</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_renderer</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>state2</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>cam2</span>.<span style=color:#a6e22e>getState</span>();
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>cam2</span>.<span style=color:#a6e22e>state_reset</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>state2</span>;   <span style=color:#75715e>// state to use on reset (double-click/tap)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>cam2</span>.<span style=color:#a6e22e>setViewport</span>([<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>900</span>, <span style=color:#ae81ff>900</span>]);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;XD&#34;</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>draw</span>() {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 1. compute current main canvas camera params
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>position</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>fbo1</span>.<span style=color:#a6e22e>treeLocation</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>center</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Vector</span>.<span style=color:#a6e22e>add</span>(<span style=color:#a6e22e>position</span>, <span style=color:#a6e22e>fbo1</span>.<span style=color:#a6e22e>treeDisplacement</span>());
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>up</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>fbo1</span>.<span style=color:#a6e22e>treeDisplacement</span>(<span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>j</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo1TextPort1</span>.<span style=color:#a6e22e>camera</span>(<span style=color:#a6e22e>position</span>.<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>position</span>.<span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>position</span>.<span style=color:#a6e22e>z</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>center</span>.<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>center</span>.<span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>center</span>.<span style=color:#a6e22e>z</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>up</span>.<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>up</span>.<span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>up</span>.<span style=color:#a6e22e>z</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo1TextPort2</span>.<span style=color:#a6e22e>camera</span>(<span style=color:#a6e22e>position</span>.<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>position</span>.<span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>position</span>.<span style=color:#a6e22e>z</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>center</span>.<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>center</span>.<span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>center</span>.<span style=color:#a6e22e>z</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>up</span>.<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>up</span>.<span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>up</span>.<span style=color:#a6e22e>z</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo1Off1</span>.<span style=color:#a6e22e>camera</span>(<span style=color:#a6e22e>position</span>.<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>position</span>.<span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>position</span>.<span style=color:#a6e22e>z</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>center</span>.<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>center</span>.<span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>center</span>.<span style=color:#a6e22e>z</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>up</span>.<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>up</span>.<span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>up</span>.<span style=color:#a6e22e>z</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo1Off2</span>.<span style=color:#a6e22e>camera</span>(<span style=color:#a6e22e>position</span>.<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>position</span>.<span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>position</span>.<span style=color:#a6e22e>z</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>center</span>.<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>center</span>.<span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>center</span>.<span style=color:#a6e22e>z</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>up</span>.<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>up</span>.<span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>up</span>.<span style=color:#a6e22e>z</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo1Off3</span>.<span style=color:#a6e22e>camera</span>(<span style=color:#a6e22e>position</span>.<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>position</span>.<span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>position</span>.<span style=color:#a6e22e>z</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>center</span>.<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>center</span>.<span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>center</span>.<span style=color:#a6e22e>z</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>up</span>.<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>up</span>.<span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>up</span>.<span style=color:#a6e22e>z</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo1Off4</span>.<span style=color:#a6e22e>camera</span>(<span style=color:#a6e22e>position</span>.<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>position</span>.<span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>position</span>.<span style=color:#a6e22e>z</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>center</span>.<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>center</span>.<span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>center</span>.<span style=color:#a6e22e>z</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>up</span>.<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>up</span>.<span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>up</span>.<span style=color:#a6e22e>z</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo2Off1</span>.<span style=color:#a6e22e>camera</span>(<span style=color:#a6e22e>position</span>.<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>position</span>.<span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>position</span>.<span style=color:#a6e22e>z</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>center</span>.<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>center</span>.<span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>center</span>.<span style=color:#a6e22e>z</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>up</span>.<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>up</span>.<span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>up</span>.<span style=color:#a6e22e>z</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo2Off2</span>.<span style=color:#a6e22e>camera</span>(<span style=color:#a6e22e>position</span>.<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>position</span>.<span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>position</span>.<span style=color:#a6e22e>z</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>center</span>.<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>center</span>.<span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>center</span>.<span style=color:#a6e22e>z</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>up</span>.<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>up</span>.<span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>up</span>.<span style=color:#a6e22e>z</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo2Off3</span>.<span style=color:#a6e22e>camera</span>(<span style=color:#a6e22e>position</span>.<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>position</span>.<span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>position</span>.<span style=color:#a6e22e>z</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>center</span>.<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>center</span>.<span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>center</span>.<span style=color:#a6e22e>z</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>up</span>.<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>up</span>.<span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>up</span>.<span style=color:#a6e22e>z</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo2Off4</span>.<span style=color:#a6e22e>camera</span>(<span style=color:#a6e22e>position</span>.<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>position</span>.<span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>position</span>.<span style=color:#a6e22e>z</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>center</span>.<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>center</span>.<span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>center</span>.<span style=color:#a6e22e>z</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>up</span>.<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>up</span>.<span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>up</span>.<span style=color:#a6e22e>z</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 2. set scenes
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>scene</span>(<span style=color:#a6e22e>fbo1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>); <span style=color:#75715e>// Escena Principal
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>scene</span>(<span style=color:#a6e22e>fbo1TextPort1</span>, <span style=color:#f92672>-</span>(<span style=color:#ae81ff>1</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>880</span>), <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>); <span style=color:#75715e>// Escena Portal 1 de la escena principal
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>scene</span>(<span style=color:#a6e22e>fbo1Off1</span>, <span style=color:#f92672>-</span>(<span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>880</span>), <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>); <span style=color:#75715e>// Escena Portal 1 de la escena Off 1
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>scene</span>(<span style=color:#a6e22e>fbo1Off2</span>, <span style=color:#f92672>-</span>(<span style=color:#ae81ff>3</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>880</span>), <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>); <span style=color:#75715e>// Escena Portal 1 de la escena Off 2
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>scene</span>(<span style=color:#a6e22e>fbo1Off3</span>, <span style=color:#f92672>-</span>(<span style=color:#ae81ff>4</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>880</span>), <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>); <span style=color:#75715e>// Escena Portal 1 de la escena Off 3
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>scene</span>(<span style=color:#a6e22e>fbo1Off4</span>, <span style=color:#f92672>-</span>(<span style=color:#ae81ff>5</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>880</span>), <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>); <span style=color:#75715e>// Escena Portal 1 de la escena Off 4
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>scene</span>(<span style=color:#a6e22e>fbo1TextPort2</span>, (<span style=color:#ae81ff>1</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>880</span>), <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>); <span style=color:#75715e>// Escena Portal 2 de la escena principal
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>scene</span>(<span style=color:#a6e22e>fbo2Off1</span>, (<span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>880</span>), <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>); <span style=color:#75715e>// Escena Portal 2 de la escena Off 1
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>scene</span>(<span style=color:#a6e22e>fbo2Off2</span>, (<span style=color:#ae81ff>3</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>880</span>), <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>); <span style=color:#75715e>// Escena Portal 2 de la escena Off 2
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>scene</span>(<span style=color:#a6e22e>fbo2Off3</span>, (<span style=color:#ae81ff>4</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>880</span>), <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>); <span style=color:#75715e>// Escena Portal 2 de la escena Off 3
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>scene</span>(<span style=color:#a6e22e>fbo2Off4</span>, (<span style=color:#ae81ff>5</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>880</span>), <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>); <span style=color:#75715e>// Escena Portal 2 de la escena Off 4
</span></span></span><span style=display:flex><span><span style=color:#75715e></span> 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>player1</span>.<span style=color:#a6e22e>movement</span>();
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>player1</span>.<span style=color:#a6e22e>render</span>(<span style=color:#a6e22e>fbo1</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>teleportedFbo1</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>!</span><span style=color:#a6e22e>teleportedFbo2</span>) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>abs</span>(<span style=color:#a6e22e>player1</span>.<span style=color:#a6e22e>playerPos</span>.<span style=color:#a6e22e>z</span>) <span style=color:#f92672>&lt;</span> (<span style=color:#a6e22e>abs</span>(<span style=color:#a6e22e>portal1Onfbo1</span>.<span style=color:#a6e22e>portalPos</span>.<span style=color:#a6e22e>z</span>) <span style=color:#f92672>-</span> <span style=color:#ae81ff>40</span>)) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>starCheck1</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>abs</span>(<span style=color:#a6e22e>player1</span>.<span style=color:#a6e22e>playerPos</span>.<span style=color:#a6e22e>z</span>) <span style=color:#f92672>&lt;</span> (<span style=color:#a6e22e>abs</span>(<span style=color:#a6e22e>portal2Onfbo1</span>.<span style=color:#a6e22e>portalPos</span>.<span style=color:#a6e22e>z</span>) <span style=color:#f92672>-</span> <span style=color:#ae81ff>40</span>)) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>starCheck2</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>starCheck1</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>teleportedFbo1</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>portal1Onfbo1</span>.<span style=color:#a6e22e>check</span>(<span style=color:#a6e22e>player1</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>starCheck2</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>teleportedFbo2</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>portal2Onfbo1</span>.<span style=color:#a6e22e>check</span>(<span style=color:#a6e22e>player1</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>teleportedFbo1</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>teleportedFbo2</span>) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>abs</span>(<span style=color:#a6e22e>player1</span>.<span style=color:#a6e22e>playerPos</span>.<span style=color:#a6e22e>z</span>) <span style=color:#f92672>&lt;</span> (<span style=color:#a6e22e>abs</span>(<span style=color:#a6e22e>portal1Onfbo1</span>.<span style=color:#a6e22e>portalPos</span>.<span style=color:#a6e22e>z</span>) <span style=color:#f92672>-</span> <span style=color:#ae81ff>40</span>)) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>starCheck1</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>abs</span>(<span style=color:#a6e22e>player1</span>.<span style=color:#a6e22e>playerPos</span>.<span style=color:#a6e22e>z</span>) <span style=color:#f92672>&lt;</span> (<span style=color:#a6e22e>abs</span>(<span style=color:#a6e22e>portal2Onfbo1</span>.<span style=color:#a6e22e>portalPos</span>.<span style=color:#a6e22e>z</span>) <span style=color:#f92672>-</span> <span style=color:#ae81ff>40</span>)) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>starCheck2</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>starCheck1</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>teleportedFbo1</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>portal1Onfbo1</span>.<span style=color:#a6e22e>check</span>(<span style=color:#a6e22e>player1</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>starCheck2</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>teleportedFbo2</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>portal2Onfbo1</span>.<span style=color:#a6e22e>check</span>(<span style=color:#a6e22e>player1</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> ((<span style=color:#f92672>!</span><span style=color:#a6e22e>teleportedFbo1</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>!</span><span style=color:#a6e22e>teleportedFbo2</span>)) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>abs</span>(<span style=color:#a6e22e>player1</span>.<span style=color:#a6e22e>playerPos</span>.<span style=color:#a6e22e>z</span>) <span style=color:#f92672>&lt;</span> (<span style=color:#a6e22e>abs</span>(<span style=color:#a6e22e>portal1Onfbo1</span>.<span style=color:#a6e22e>portalPos</span>.<span style=color:#a6e22e>z</span>) <span style=color:#f92672>-</span> <span style=color:#ae81ff>40</span>)) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>starCheck1</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>abs</span>(<span style=color:#a6e22e>player1</span>.<span style=color:#a6e22e>playerPos</span>.<span style=color:#a6e22e>z</span>) <span style=color:#f92672>&lt;</span> (<span style=color:#a6e22e>abs</span>(<span style=color:#a6e22e>portal2Onfbo1</span>.<span style=color:#a6e22e>portalPos</span>.<span style=color:#a6e22e>z</span>) <span style=color:#f92672>-</span> <span style=color:#ae81ff>40</span>)) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>starCheck2</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>starCheck1</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>teleportedFbo1</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>portal1Onfbo1</span>.<span style=color:#a6e22e>check</span>(<span style=color:#a6e22e>player1</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>starCheck2</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>teleportedFbo2</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>portal2Onfbo1</span>.<span style=color:#a6e22e>check</span>(<span style=color:#a6e22e>player1</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>teleportedFbo1</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>set1</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>teleportedFbo2</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>set2</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>set1</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>player1</span>.<span style=color:#a6e22e>pos</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>portal2Onfbo1</span>.<span style=color:#a6e22e>portalPos</span>;
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>starCheck2</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>set1</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>set2</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>player1</span>.<span style=color:#a6e22e>pos</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>portal1Onfbo1</span>.<span style=color:#a6e22e>portalPos</span>;
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>starCheck1</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>set2</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>player1</span>.<span style=color:#a6e22e>playerPos</span> <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>playerOnPortal1</span>.<span style=color:#a6e22e>pos</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>player1</span>.<span style=color:#a6e22e>pos</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>playerOnPortal1</span>.<span style=color:#a6e22e>a</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>player1</span>.<span style=color:#a6e22e>a</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>playerOnPortal1</span>.<span style=color:#a6e22e>render</span>(<span style=color:#a6e22e>fbo1TextPort1</span>, <span style=color:#f92672>-</span>(<span style=color:#ae81ff>1</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>880</span>));
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>playerOnPortal1</span>.<span style=color:#a6e22e>render</span>(<span style=color:#a6e22e>fbo1Off1</span>, <span style=color:#f92672>-</span>(<span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>880</span>));
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>playerOnPortal1</span>.<span style=color:#a6e22e>render</span>(<span style=color:#a6e22e>fbo1Off2</span>, <span style=color:#f92672>-</span>(<span style=color:#ae81ff>3</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>880</span>));
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>playerOnPortal1</span>.<span style=color:#a6e22e>render</span>(<span style=color:#a6e22e>fbo1Off3</span>, <span style=color:#f92672>-</span>(<span style=color:#ae81ff>4</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>880</span>));
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>playerOnPortal1</span>.<span style=color:#a6e22e>render</span>(<span style=color:#a6e22e>fbo1Off4</span>, <span style=color:#f92672>-</span>(<span style=color:#ae81ff>5</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>880</span>));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>playerOnPortal2</span>.<span style=color:#a6e22e>pos</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>player1</span>.<span style=color:#a6e22e>pos</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>playerOnPortal2</span>.<span style=color:#a6e22e>a</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>player1</span>.<span style=color:#a6e22e>a</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>playerOnPortal2</span>.<span style=color:#a6e22e>render</span>(<span style=color:#a6e22e>fbo1TextPort2</span>, (<span style=color:#ae81ff>1</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>880</span>));
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>playerOnPortal2</span>.<span style=color:#a6e22e>render</span>(<span style=color:#a6e22e>fbo2Off1</span>, (<span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>880</span>));
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>playerOnPortal2</span>.<span style=color:#a6e22e>render</span>(<span style=color:#a6e22e>fbo2Off2</span>, (<span style=color:#ae81ff>3</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>880</span>));
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>playerOnPortal2</span>.<span style=color:#a6e22e>render</span>(<span style=color:#a6e22e>fbo2Off3</span>, (<span style=color:#ae81ff>4</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>880</span>));
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>playerOnPortal2</span>.<span style=color:#a6e22e>render</span>(<span style=color:#a6e22e>fbo2Off4</span>, (<span style=color:#ae81ff>5</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>880</span>));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>angle</span> <span style=color:#f92672>+=</span> <span style=color:#ae81ff>0.007</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>portal1Off3</span>.<span style=color:#a6e22e>render</span>(<span style=color:#a6e22e>fbo1Off3</span>, <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>fbo1Off4</span>, <span style=color:#a6e22e>shader1Aux4</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>portal1Off2</span>.<span style=color:#a6e22e>render</span>(<span style=color:#a6e22e>fbo1Off2</span>, <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>fbo1Off3</span>, <span style=color:#a6e22e>shader1Aux3</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>portal1Off1</span>.<span style=color:#a6e22e>render</span>(<span style=color:#a6e22e>fbo1Off1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>fbo1Off2</span>, <span style=color:#a6e22e>shader1Aux2</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>portal1Onfbo1Off</span>.<span style=color:#a6e22e>render</span>(<span style=color:#a6e22e>fbo1TextPort1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>fbo1Off1</span>, <span style=color:#a6e22e>shader1Aux1</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>portal1Onfbo1</span>.<span style=color:#a6e22e>render</span>(<span style=color:#a6e22e>fbo1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>fbo1TextPort1</span>, <span style=color:#a6e22e>portalShader</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>portal2Off3</span>.<span style=color:#a6e22e>render</span>(<span style=color:#a6e22e>fbo2Off3</span>, <span style=color:#ae81ff>1</span>, <span style=color:#a6e22e>fbo2Off4</span>, <span style=color:#a6e22e>shader2Aux4</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>portal2Off2</span>.<span style=color:#a6e22e>render</span>(<span style=color:#a6e22e>fbo2Off2</span>, <span style=color:#ae81ff>1</span>, <span style=color:#a6e22e>fbo2Off3</span>, <span style=color:#a6e22e>shader2Aux3</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>portal2Off1</span>.<span style=color:#a6e22e>render</span>(<span style=color:#a6e22e>fbo2Off1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#a6e22e>fbo2Off2</span>, <span style=color:#a6e22e>shader2Aux2</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>portal2Onfbo1Off</span>.<span style=color:#a6e22e>render</span>(<span style=color:#a6e22e>fbo1TextPort2</span>, <span style=color:#ae81ff>1</span>, <span style=color:#a6e22e>fbo2Off1</span>, <span style=color:#a6e22e>shader2Aux1</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>portal2Onfbo1</span>.<span style=color:#a6e22e>render</span>(<span style=color:#a6e22e>fbo1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#a6e22e>fbo1TextPort2</span>, <span style=color:#a6e22e>portalShader</span>);
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>camCoor</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>camFovCoordinates</span>(<span style=color:#f92672>-</span><span style=color:#ae81ff>900</span>, <span style=color:#a6e22e>player1</span>.<span style=color:#a6e22e>pos</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>player1</span>.<span style=color:#a6e22e>a</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>60</span>, <span style=color:#ae81ff>40</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>cam1</span>.<span style=color:#a6e22e>camera</span>(<span style=color:#a6e22e>camCoor</span>.<span style=color:#a6e22e>xp</span>, <span style=color:#a6e22e>camCoor</span>.<span style=color:#a6e22e>yp</span>, <span style=color:#a6e22e>camCoor</span>.<span style=color:#a6e22e>zp</span>, <span style=color:#a6e22e>camCoor</span>.<span style=color:#a6e22e>xc</span>, <span style=color:#a6e22e>camCoor</span>.<span style=color:#a6e22e>yc</span>, <span style=color:#a6e22e>camCoor</span>.<span style=color:#a6e22e>zc</span>, <span style=color:#a6e22e>camCoor</span>.<span style=color:#a6e22e>xn</span>, <span style=color:#a6e22e>camCoor</span>.<span style=color:#a6e22e>yn</span>, <span style=color:#a6e22e>camCoor</span>.<span style=color:#a6e22e>zn</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>changeCam</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>onCam1</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>cam2</span>.<span style=color:#a6e22e>setCanvas</span>(<span style=color:#a6e22e>dummy</span>.<span style=color:#a6e22e>_renderer</span>);
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fbo1</span>.<span style=color:#a6e22e>setCamera</span>(<span style=color:#a6e22e>cam1</span>)
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>onCam1</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>onCam2</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>onCam2</span>) {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>fbo1</span>.<span style=color:#a6e22e>reset</span>();
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>cam2</span>.<span style=color:#a6e22e>setCanvas</span>(<span style=color:#a6e22e>fbo1</span>.<span style=color:#a6e22e>_renderer</span>);
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>onCam1</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>onCam2</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>changeCam</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>press</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>({ <span style=color:#a6e22e>x</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>player1</span>.<span style=color:#a6e22e>pos</span>.<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>player1</span>.<span style=color:#a6e22e>pos</span>.<span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>z</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>player1</span>.<span style=color:#a6e22e>pos</span>.<span style=color:#a6e22e>z</span> });
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>({ <span style=color:#a6e22e>angle</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>player1</span>.<span style=color:#a6e22e>a</span> });
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>v</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Vector</span>.<span style=color:#a6e22e>fromAngle</span>(<span style=color:#a6e22e>player1</span>.<span style=color:#a6e22e>a</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>({ <span style=color:#a6e22e>x</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>v</span>.<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>v</span>.<span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>z</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>v</span>.<span style=color:#a6e22e>z</span> });
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>press</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>beginHUD</span>();
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>image</span>(<span style=color:#a6e22e>fbo1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>endHUD</span>();
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Player</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>constructor</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>z</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pos</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createVector</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>z</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>prevPos</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pos</span>.<span style=color:#a6e22e>copy</span>();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>a</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>speed</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>aspeed</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>PI</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>90</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>playerPos</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>playerDis</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>move</span>(<span style=color:#a6e22e>fw</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>prevPos</span>.<span style=color:#a6e22e>set</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pos</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>vel</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Vector</span>.<span style=color:#a6e22e>fromAngle</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>a</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>fw</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>vel</span>.<span style=color:#a6e22e>mult</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>speed</span>);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pos</span>.<span style=color:#a6e22e>add</span>(<span style=color:#f92672>-</span><span style=color:#a6e22e>vel</span>.<span style=color:#a6e22e>x</span>, <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>vel</span>.<span style=color:#a6e22e>y</span>);
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>vel</span>.<span style=color:#a6e22e>mult</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>speed</span>);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pos</span>.<span style=color:#a6e22e>add</span>(<span style=color:#a6e22e>vel</span>.<span style=color:#a6e22e>x</span>, <span style=color:#ae81ff>0</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>vel</span>.<span style=color:#a6e22e>y</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pos</span>.<span style=color:#a6e22e>x</span> <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>400</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pos</span>.<span style=color:#a6e22e>x</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>400</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pos</span>.<span style=color:#a6e22e>z</span> <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>400</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pos</span>.<span style=color:#a6e22e>z</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>400</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pos</span>.<span style=color:#a6e22e>x</span> <span style=color:#f92672>&lt;</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>400</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pos</span>.<span style=color:#a6e22e>x</span> <span style=color:#f92672>=</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>400</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pos</span>.<span style=color:#a6e22e>z</span> <span style=color:#f92672>&lt;</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>410</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pos</span>.<span style=color:#a6e22e>z</span> <span style=color:#f92672>=</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>410</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>movement</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>keyIsDown</span>(<span style=color:#ae81ff>65</span>))
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>turn</span>(<span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>keyIsDown</span>(<span style=color:#ae81ff>68</span>))
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>turn</span>(<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>keyIsDown</span>(<span style=color:#ae81ff>87</span>))
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>move</span>(<span style=color:#66d9ef>true</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>keyIsDown</span>(<span style=color:#ae81ff>83</span>))
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>move</span>(<span style=color:#66d9ef>false</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>turn</span>(<span style=color:#a6e22e>dir</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>a</span> <span style=color:#f92672>+=</span> <span style=color:#a6e22e>dir</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>aspeed</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>render</span>(<span style=color:#a6e22e>fbo</span>, <span style=color:#a6e22e>displacement</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>push</span>();
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>translate</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>displacement</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>translate</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pos</span>.<span style=color:#a6e22e>x</span>, <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pos</span>.<span style=color:#a6e22e>y</span>, <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pos</span>.<span style=color:#a6e22e>z</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>rotateY</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>a</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>noStroke</span>();
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>push</span>();
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>rotateZ</span>(<span style=color:#a6e22e>PI</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>rotateY</span>(<span style=color:#a6e22e>HALF_PI</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>texture</span>(<span style=color:#a6e22e>fox_tex</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>model</span>(<span style=color:#a6e22e>fox</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>playerPos</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>treeLocation</span>(<span style=color:#75715e>/*[0, 0, 0],*/</span> { <span style=color:#a6e22e>from</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>MODEL</span>, <span style=color:#a6e22e>to</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>WORLD</span> });
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>playerDis</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>treeDisplacement</span>(<span style=color:#75715e>/*[0, 0, 0],*/</span> { <span style=color:#a6e22e>from</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>MODEL</span>, <span style=color:#a6e22e>to</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>WORLD</span> });
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>pop</span>();
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>pop</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Portal</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>constructor</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>z</span>, <span style=color:#a6e22e>a</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pos</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createVector</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>z</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>len</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>220</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>a</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>a</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>portalPos</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>linkedPortal</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>link</span>(<span style=color:#a6e22e>other</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>linkedPortal</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>other</span>;
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>other</span>.<span style=color:#a6e22e>linkedPortal</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>check_</span>(<span style=color:#a6e22e>player</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>relativePos</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>player</span>.<span style=color:#a6e22e>playerPos</span>.<span style=color:#a6e22e>copy</span>();
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>relativePos</span>.<span style=color:#a6e22e>sub</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>portalPos</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>relativePos</span>.<span style=color:#a6e22e>rotate</span>(<span style=color:#f92672>-</span><span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>a</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>relativePrevPos</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>player</span>.<span style=color:#a6e22e>prevPos</span>.<span style=color:#a6e22e>copy</span>();
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>relativePrevPos</span>.<span style=color:#a6e22e>sub</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>portalPos</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>relativePrevPos</span>.<span style=color:#a6e22e>rotate</span>(<span style=color:#f92672>-</span><span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>a</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> ((<span style=color:#a6e22e>abs</span>(<span style=color:#a6e22e>relativePos</span>.<span style=color:#a6e22e>z</span>) <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>38</span>) <span style=color:#f92672>!==</span> (<span style=color:#a6e22e>abs</span>(<span style=color:#a6e22e>relativePrevPos</span>.<span style=color:#a6e22e>z</span>) <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>38</span>) <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>abs</span>(<span style=color:#a6e22e>relativePos</span>.<span style=color:#a6e22e>x</span>) <span style=color:#f92672>&lt;</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>len</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;Teletransportado&#34;</span>);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>check</span>(<span style=color:#a6e22e>player</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>check_</span>(<span style=color:#a6e22e>player</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>render</span>(<span style=color:#a6e22e>fbo</span>, <span style=color:#a6e22e>numberPortal</span>, <span style=color:#a6e22e>texElement</span>, <span style=color:#a6e22e>portalShader</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>push</span>()
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>translate</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pos</span>.<span style=color:#a6e22e>x</span>, <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pos</span>.<span style=color:#a6e22e>y</span>, <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pos</span>.<span style=color:#a6e22e>z</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>rotateY</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>a</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>push</span>()
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>translate</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>numberPortal</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>fill</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>255</span>)
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>fill</span>(<span style=color:#ae81ff>255</span>, <span style=color:#ae81ff>158</span>, <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>circle</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>260</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>pop</span>()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>portalShader</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>resetShader</span>();
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>shader</span>(<span style=color:#a6e22e>portalShader</span>);
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>emitResolution</span>(<span style=color:#a6e22e>portalShader</span>);
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>portalShader</span>.<span style=color:#a6e22e>setUniform</span>(<span style=color:#e6db74>&#39;texture&#39;</span>, <span style=color:#a6e22e>texElement</span>);
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>texElement</span>) {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>texture</span>(<span style=color:#a6e22e>texElement</span>);
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>circle</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>250</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>portalPos</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>treeLocation</span>(<span style=color:#75715e>/*[0, 0, 0],*/</span> { <span style=color:#a6e22e>from</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>MODEL</span>, <span style=color:#a6e22e>to</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>WORLD</span> });
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>pop</span>()
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>scene</span>(<span style=color:#a6e22e>fbo</span>, <span style=color:#a6e22e>displacement</span>, <span style=color:#a6e22e>frontWall</span>, <span style=color:#a6e22e>backWall</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>background</span>(<span style=color:#ae81ff>120</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>reset</span>();
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>rectMode</span>(<span style=color:#a6e22e>CENTER</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>noStroke</span>();
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>push</span>();
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>translate</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>displacement</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>ambientLight</span>(<span style=color:#ae81ff>255</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>push</span>();
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>rotateZ</span>(<span style=color:#a6e22e>angle</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>rotateX</span>(<span style=color:#a6e22e>angle</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>rotateY</span>(<span style=color:#a6e22e>angle</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>texture</span>(<span style=color:#a6e22e>kemonaSilver</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>box</span>(<span style=color:#ae81ff>100</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>pop</span>();
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>push</span>();
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>translate</span>(<span style=color:#f92672>-</span><span style=color:#ae81ff>350</span>, <span style=color:#ae81ff>0</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>350</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>rotateZ</span>(<span style=color:#a6e22e>angle</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>rotateX</span>(<span style=color:#a6e22e>angle</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>rotateY</span>(<span style=color:#a6e22e>angle</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>texture</span>(<span style=color:#a6e22e>cat1_tex</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>model</span>(<span style=color:#a6e22e>cat1</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>pop</span>();
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>push</span>();
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>translate</span>(<span style=color:#ae81ff>350</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>350</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>rotateZ</span>(<span style=color:#a6e22e>angle</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>rotateX</span>(<span style=color:#a6e22e>angle</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>rotateY</span>(<span style=color:#a6e22e>angle</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>texture</span>(<span style=color:#a6e22e>cat2_tex</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>model</span>(<span style=color:#a6e22e>cat2</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>pop</span>();
</span></span><span style=display:flex><span>    <span style=color:#75715e>// PISO
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>push</span>();
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>stroke</span>(<span style=color:#ae81ff>2</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>ambientLight</span>(<span style=color:#ae81ff>255</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>ambientMaterial</span>(<span style=color:#ae81ff>100</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>translate</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>110</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>rotateX</span>(<span style=color:#a6e22e>HALF_PI</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>box</span>(<span style=color:#ae81ff>900</span>, <span style=color:#ae81ff>900</span>, <span style=color:#ae81ff>20</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>pop</span>();
</span></span><span style=display:flex><span>    <span style=color:#75715e>// PAREDES
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>frontWall</span>) {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Frontal Z+
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>push</span>();
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>stroke</span>(<span style=color:#ae81ff>2</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>ambientLight</span>(<span style=color:#ae81ff>255</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>ambientMaterial</span>(<span style=color:#ae81ff>100</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>translate</span>(<span style=color:#ae81ff>0</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>25</span>, <span style=color:#ae81ff>450</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>box</span>(<span style=color:#ae81ff>900</span>, <span style=color:#ae81ff>250</span>, <span style=color:#ae81ff>20</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>pop</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>backWall</span>) {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Trasera Z-
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>push</span>();
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>stroke</span>(<span style=color:#ae81ff>2</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>ambientLight</span>(<span style=color:#ae81ff>255</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>ambientMaterial</span>(<span style=color:#ae81ff>100</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>translate</span>(<span style=color:#ae81ff>0</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>25</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>450</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>box</span>(<span style=color:#ae81ff>900</span>, <span style=color:#ae81ff>250</span>, <span style=color:#ae81ff>20</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>pop</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Lateral Derecha X+
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>push</span>();
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>stroke</span>(<span style=color:#ae81ff>2</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>ambientLight</span>(<span style=color:#ae81ff>255</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>ambientMaterial</span>(<span style=color:#ae81ff>100</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>translate</span>(<span style=color:#ae81ff>450</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>25</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>rotateY</span>(<span style=color:#a6e22e>HALF_PI</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>box</span>(<span style=color:#ae81ff>900</span>, <span style=color:#ae81ff>250</span>, <span style=color:#ae81ff>20</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>pop</span>();
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Trasera Izquierda X-
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>push</span>();
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>stroke</span>(<span style=color:#ae81ff>2</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>ambientLight</span>(<span style=color:#ae81ff>255</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>ambientMaterial</span>(<span style=color:#ae81ff>100</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>translate</span>(<span style=color:#f92672>-</span><span style=color:#ae81ff>450</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>25</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>rotateY</span>(<span style=color:#a6e22e>HALF_PI</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>box</span>(<span style=color:#ae81ff>900</span>, <span style=color:#ae81ff>250</span>, <span style=color:#ae81ff>20</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>pop</span>();
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>pop</span>();
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>keyPressed</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>keyCode</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>67</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>changeCam</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>changeCam</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>keyCode</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>73</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>press</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>press</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>camFovCoordinates</span>(<span style=color:#a6e22e>radio</span>, <span style=color:#a6e22e>posVec</span>, <span style=color:#a6e22e>angle</span>, <span style=color:#a6e22e>hy</span>, <span style=color:#a6e22e>chy</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>vecAngle</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Vector</span>.<span style=color:#a6e22e>fromAngle</span>(<span style=color:#a6e22e>angle</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>radioCam</span> <span style=color:#f92672>=</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>10</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> { <span style=color:#a6e22e>xp</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>posVec</span>.<span style=color:#a6e22e>x</span> <span style=color:#f92672>+</span> (<span style=color:#a6e22e>radioCam</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>vecAngle</span>.<span style=color:#a6e22e>x</span>)), <span style=color:#a6e22e>yp</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>posVec</span>.<span style=color:#a6e22e>y</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>hy</span>, <span style=color:#a6e22e>zp</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>posVec</span>.<span style=color:#a6e22e>z</span> <span style=color:#f92672>+</span> (<span style=color:#a6e22e>radioCam</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>vecAngle</span>.<span style=color:#a6e22e>y</span>)), <span style=color:#a6e22e>xc</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>posVec</span>.<span style=color:#a6e22e>x</span> <span style=color:#f92672>+</span> (<span style=color:#a6e22e>radio</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>vecAngle</span>.<span style=color:#a6e22e>x</span>)), <span style=color:#a6e22e>yc</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>posVec</span>.<span style=color:#a6e22e>y</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>chy</span>, <span style=color:#a6e22e>zc</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>posVec</span>.<span style=color:#a6e22e>z</span> <span style=color:#f92672>+</span> (<span style=color:#a6e22e>radio</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>vecAngle</span>.<span style=color:#a6e22e>y</span>)), <span style=color:#a6e22e>xn</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>yn</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>1</span>, <span style=color:#a6e22e>zn</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span> };
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></div></details><details><summary>Comandos</summary><div class=markdown-inner><table><thead><tr><th>Tecla</th><th>Descripción</th></tr></thead><tbody><tr><td>W</td><td>Mover hacia adelante</td></tr><tr><td>A</td><td>Girar hacia la izquierda</td></tr><tr><td>D</td><td>Girar hacia la derecha</td></tr><tr><td>S</td><td>Mover hacia atrás</td></tr><tr><td>C</td><td>Cambiar vista primera/tercera persona</td></tr></tbody></table></div></details><iframe id=portalShaderV3 style=width:925px;height:925px srcdoc="
        <!DOCTYPE html>
        <html>
          <head>
            <script src=https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/p5.min.js></script>
            <script src=https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/addons/p5.sound.min.js></script>
             <script src=https://cdn.jsdelivr.net/gh/VisualComputing/p5.treegl/p5.treegl.js></script> 
             <script src=https://cdn.jsdelivr.net/gh/freshfork/p5.EasyCam@1.2.1/p5.easycam.js></script> 
            
            
            
            <script src=/sketches/portalShaderV3.js></script>
          </head>
          <body>
          </body>
        </html>
      "></iframe><p><strong>Referencias</strong></p><p><a href=https://visualcomputing.github.io/docs/shaders/non-euclidean_geometry/>https://visualcomputing.github.io/docs/shaders/non-euclidean_geometry/</a>
<a href=https://es.wikipedia.org/wiki/Geometr%C3%ADa_no_euclidiana>https://es.wikipedia.org/wiki/Geometr%C3%ADa_no_euclidiana</a></p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/jussilvaca/commit/6a6b479df6ef0b662272c394adaf6bb2319240ba title='Last modified by jussilvaca | December 4, 2022' target=_blank rel=noopener><img src=/svg/calendar.svg class=book-icon alt=Calendar>
<span>December 4, 2022</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><ul><li><a href=#portal-shaders-dos-portales>Portal Shaders Dos Portales</a></li><li><a href=#portal-shaders-con-múltiples-reflejos>Portal Shaders Con Múltiples reflejos</a></li></ul></li></ul></nav></div></aside></main></body></html>